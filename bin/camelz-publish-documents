#!/bin/bash
#
# Cross-Account Multi-Environment Landing Zones Framework - Publish Documents
#

bindir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
rootdir=${bindir%/*}
srcdir=$rootdir/src
bucketdir=$rootdir/bucket

echo "Publishing Documents"
echo "  - src   : $srcdir"
echo "  - bucket: $bucketdir"
echo "===================="

pushd $srcdir &> /dev/null
for document in $(ls -1 *.{yaml,json} 2> /dev/null); do
  echo -n "- ${document%.*}... "
  mkdir -p $bucketdir/${document%.*}
  md5=$(md5 -q $srcdir/$document)
  if [ ! -f $bucketdir/${document%.*}/$md5.${document#*.} ]; then
    echo "Published ($md5.${document#*.})"
    cp $srcdir/$document $bucketdir/${document%.*}/$md5.${document#*.}
  else
    echo "Unchanged"
  fi
done
popd &> /dev/null
